<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QC and Sample Size Estimation • prolfqua</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="QC and Sample Size Estimation">
<meta property="og:description" content="prolfqua">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prolfqua</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Comparing2Groups.html">Comparing Two Groups with prolfqua</a>
    </li>
    <li>
      <a href="../articles/CreatingConfigurations.html">Creating prolfqua Configurations</a>
    </li>
    <li>
      <a href="../articles/Modelling2Factors.html">Modelling dataset with two Factors</a>
    </li>
    <li>
      <a href="../articles/QCandSampleSize.html">Quality Control &amp; Sample Size Estimation</a>
    </li>
    <li>
      <a href="../articles/QualityControlAndSampleSizeEstimation.html">QC and Sample Size Estimation</a>
    </li>
    <li>
      <a href="../articles/Supplement_TidyAnalysis_HL_Skyline.html">Supplement - Data preprocessing of SRM Heavy Light data</a>
    </li>
    <li>
      <a href="../articles/Supplement_TidyAnalysis_Skyline_PRM.html">Supplement - Data preprocessing for PRM</a>
    </li>
    <li>
      <a href="../articles/Supplement_TidyCorrelationAnalysis.html">Supplement - Filter precursors or fragments based on correlation</a>
    </li>
    <li>
      <a href="../articles/Supplement_srm_summary.html">Supplement - Summarize SRM Peptide Level Measurements</a>
    </li>
    <li>
      <a href="../articles/Supplement_srm_summary_HL.html">Supplement - Summarize heavy light Peptide Level Measurements</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wolski/prolfqua/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>QC and Sample Size Estimation</h1>
                        <h4 data-toc-skip class="author">Witold E.
Wolski</h4>
            
            <h4 data-toc-skip class="date">2023-04-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wolski/prolfqua/blob/HEAD/vignettes/QualityControlAndSampleSizeEstimation.Rmd" class="external-link"><code>vignettes/QualityControlAndSampleSizeEstimation.Rmd</code></a></small>
      <div class="hidden name"><code>QualityControlAndSampleSizeEstimation.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>This vignette demonstrates how the package can be used to create
descriptive statistics or quality control plots for a dataset. First, we
read a “proteinGroups.txt” file from the MaxQuant software, and next, we
specify a prolfqua configuration. Afterward, the data is transformed and
normalized, and plots describing the data are generated. Finally, we
estimate how many samples are necessary to properly quantify a two-fold
change for <span class="math inline">\(90%\)</span> of all the proteins
with a power of <span class="math inline">\(0.8\)</span>.</p>
</div>
<div class="section level2">
<h2 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h2>
<p>Load the data from MaxQuant. In this case here we direclty load
protein level data from the proteinGroups.txt file.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datadir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">find.package</a></span><span class="op">(</span><span class="st">"prolfqua"</span><span class="op">)</span> , <span class="st">"samples/maxquant_txt"</span><span class="op">)</span></span>
<span><span class="va">inputMQfile</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">datadir</span>, <span class="st">"tiny2.zip"</span><span class="op">)</span></span>
<span><span class="va">inputAnnotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">datadir</span>, <span class="st">"annotation_Ionstar2018_PXD003881.xlsx"</span><span class="op">)</span></span>
<span><span class="va">startdata</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/tidyMQ_ProteinGroups.html">tidyMQ_ProteinGroups</a></span><span class="op">(</span><span class="va">inputMQfile</span><span class="op">)</span></span></code></pre></div>
<p>Read the annotation with the meta information that is associated with
the samples.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotation</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="va">inputAnnotation</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">startdata</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">annotation</span>, <span class="va">startdata</span>, by <span class="op">=</span> <span class="st">"raw.file"</span><span class="op">)</span></span>
<span><span class="va">startdata</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 14</span></span></span>
<span><span class="co">##   raw.file   run_ID date  sample prote…¹ major…² nr.pe…³ fasta…⁴ prote…⁵ prote…⁶</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> b03_02_15… 02     1503… b      sp|Q14… sp|Q14…       8 sp|Q14…    <span style="text-decoration: underline;">2</span>835   22.1 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> b03_02_15… 02     1503… b      sp|Q9N… sp|Q9N…       4 sp|Q9N…    <span style="text-decoration: underline;">4</span>547    5.17</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> b03_02_15… 02     1503… b      sp|Q14… sp|Q14…       1 sp|Q14…    <span style="text-decoration: underline;">2</span>809    2.35</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> b03_02_15… 02     1503… b      sp|O60… sp|O60…      11 sp|O60…     430   68.3 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> b03_02_15… 02     1503… b      sp|Q9Y… sp|Q9Y…       4 sp|Q9Y…    <span style="text-decoration: underline;">4</span>887   10.6 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> b03_02_15… 02     1503… b      sp|Q99… sp|Q99…       3 sp|Q99…    <span style="text-decoration: underline;">3</span>940    8.33</span></span>
<span><span class="co">## <span style="color: #949494;"># … with 4 more variables: proteinID &lt;chr&gt;, mq.protein.intensity &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   mq.protein.lfq.intensity &lt;dbl&gt;, mq.protein.ms.ms.count &lt;int&gt;, and</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   abbreviated variable names ¹​protein.ids, ²​majority.protein.ids,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ³​nr.peptides, ⁴​fasta.headers, ⁵​protein.group.id, ⁶​protein.score</span></span></span></code></pre>
<p>First, we want to remove all proteins identified only by a single
peptide.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">startdata</span> <span class="op">&lt;-</span> <span class="va">startdata</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nr.peptides</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We need to <em>tell</em> <code>prolfqua</code> which columns in the
table contain what information. This is done using the
<code>AnalysisTableAnnotation</code> class.</p>
<p>The <code>hierarchy</code> describes the structure of the MS data. In
this case we have only protein level measurements and therefore
<code>hierarchyDepht</code> is equal to <span class="math inline">\(1\)</span>. In addition you need to describe the
factors of the analysis, i.e, the column containing the explanatory
variables which in this benchmark dataset is the dilution specified as
sample in the annotation table. You also need to specify the column
containing the protein identifiers and the protein intensities.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atable</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/AnalysisTableAnnotation.html">AnalysisTableAnnotation</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">atable</span><span class="op">$</span><span class="va">fileName</span> <span class="op">=</span> <span class="st">"raw.file"</span></span>
<span><span class="va">atable</span><span class="op">$</span><span class="va">hierarchy</span><span class="op">[[</span><span class="st">"protein_Id"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"proteinID"</span><span class="op">)</span></span>
<span><span class="va">atable</span><span class="op">$</span><span class="va">hierarchyDepth</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">atable</span><span class="op">$</span><span class="fu">set_response</span><span class="op">(</span><span class="st">"mq.protein.intensity"</span><span class="op">)</span></span>
<span><span class="va">atable</span><span class="op">$</span><span class="va">factors</span><span class="op">[[</span><span class="st">"dilution."</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"sample"</span></span>
<span><span class="va">atable</span><span class="op">$</span><span class="va">factors</span><span class="op">[[</span><span class="st">"Run_ID"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"run_ID"</span></span>
<span><span class="va">atable</span><span class="op">$</span><span class="va">factorDepth</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/AnalysisConfiguration.html">AnalysisConfiguration</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">atable</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adata</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/setup_analysis.html">setup_analysis</a></span><span class="op">(</span><span class="va">startdata</span>, <span class="va">config</span><span class="op">)</span></span></code></pre></div>
<p>Further steps are the creation of the LFQData class instance and the
usual standard preprocessing such as the removal of zeros from data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqdata</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/LFQData.html">LFQData</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">adata</span>, <span class="va">config</span><span class="op">)</span></span>
<span><span class="va">lfqdata</span><span class="op">$</span><span class="fu">remove_small_intensities</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>You can convert the data into a data frame in a wide format, where
the intensities of each sample occupy their columns.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqdata</span><span class="op">$</span><span class="fu">to_wide</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 8</span></span></span>
<span><span class="co">##   protein_Id            isotopeLabel   `a~10` `a~11` `a~20` `a~21` `b~02` `b~09`</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sp|A4D1E9|GTPBA_HUMAN light        25<span style="text-decoration: underline;">406</span>000 4.28<span style="color: #949494;">e</span>7 3.96<span style="color: #949494;">e</span>7 3.83<span style="color: #949494;">e</span>7 3.96<span style="color: #949494;">e</span>7 3.05<span style="color: #949494;">e</span>7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> sp|A6ZKI3|RTL8C_HUMAN light        36<span style="text-decoration: underline;">140</span>000 4.47<span style="color: #949494;">e</span>7 3.92<span style="color: #949494;">e</span>7 4.15<span style="color: #949494;">e</span>7 3.30<span style="color: #949494;">e</span>7 2.89<span style="color: #949494;">e</span>7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sp|C4AMC7|WASH3_HUMAN light        12<span style="text-decoration: underline;">188</span>000 1.83<span style="color: #949494;">e</span>7 9.36<span style="color: #949494;">e</span>6 8.94<span style="color: #949494;">e</span>6 9.92<span style="color: #949494;">e</span>6 1.60<span style="color: #949494;">e</span>7</span></span></code></pre>
<div class="section level3">
<h3 id="visualization-of-not-normalized-data">Visualization of not normalized data<a class="anchor" aria-label="anchor" href="#visualization-of-not-normalized-data"></a>
</h3>
<p>Next we show how the data is distributed before transformation and
normalization.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqplotter</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lfqplotter</span><span class="op">$</span><span class="fu">intensity_distribution_density</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="QualityControlAndSampleSizeEstimation_files/figure-html/intensityDistribution-1.png" width="700"></p>
<div class="section level4">
<h4 id="visualization-of-missing-data">Visualization of missing data<a class="anchor" aria-label="anchor" href="#visualization-of-missing-data"></a>
</h4>
<p>Often it also makes sense to look into the part of the data that is
not quantified in all samples. Therefore several functions for the
missingess are available. In the <code>NA_heatmap</code> function it is
possible to see if some missing proteins are specific for one particular
dilution or if they appear randomly in all samples.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nah</span> <span class="op">&lt;-</span> <span class="va">lfqplotter</span><span class="op">$</span><span class="fu">NA_heatmap</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Prints missing heatmap:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nah</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/printMissingHeatmap-1.png" alt="Heatmap, black - missing protein intensities, white - present" width="700"><p class="caption">
Heatmap, black - missing protein intensities, white - present
</p>
</div>
<p>Also in the next two figures we show how many missing values are
found in the respective conditions and how many proteins do not have
missing data and how complete the measurements are for each group.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_Summariser</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">plot_missingness_per_group</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/summaryPerGroup-1.png" alt="# of proteins with 0,1,...N missing values" width="700"><p class="caption">
# of proteins with 0,1,…N missing values
</p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_Summariser</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">plot_missingness_per_group_cumsum</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/cumSumSummary-1.png" alt="Cumulative sum of the # of proteins with 0,1,...N missing values" width="700"><p class="caption">
Cumulative sum of the # of proteins with 0,1,…N missing values
</p>
</div>
<p>In the <code>missigness_histogram</code> we can check if there is a
dependency between NAs (and the number of NAs for earch protein) with
respect to the protein intensity.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqplotter</span><span class="op">$</span><span class="fu">missigness_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/missingnessHist-1.png" alt="Intensity distribution of proteins depending on # of missing values" width="700"><p class="caption">
Intensity distribution of proteins depending on # of missing values
</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="computing-standard-deviations-mean-and-cv-">Computing standard deviations, mean and CV.<a class="anchor" aria-label="anchor" href="#computing-standard-deviations-mean-and-cv-"></a>
</h2>
<p>Other important statistics that can be easily calculated from the
object are coefficient of variation, means and standard deviations.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_Stats</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span> <span class="va">stats</span><span class="op">$</span><span class="fu">stats_quantiles</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">wide</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"quantile of "</span>,<span class="va">stats</span><span class="op">$</span><span class="va">stat</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>quantile of CV</caption>
<colgroup>
<col width="9%">
<col width="15%">
<col width="13%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="right">probs</th>
<th align="right">a</th>
<th align="right">All</th>
<th align="right">b</th>
<th align="right">c</th>
<th align="right">d</th>
<th align="right">e</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.10</td>
<td align="right">9.278644</td>
<td align="right">12.71719</td>
<td align="right">9.470304</td>
<td align="right">8.938044</td>
<td align="right">9.597509</td>
<td align="right">9.806142</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">12.781369</td>
<td align="right">15.59089</td>
<td align="right">12.979955</td>
<td align="right">12.832052</td>
<td align="right">12.725484</td>
<td align="right">12.991557</td>
</tr>
<tr class="odd">
<td align="right">0.50</td>
<td align="right">17.551769</td>
<td align="right">24.13058</td>
<td align="right">18.129244</td>
<td align="right">18.373579</td>
<td align="right">18.840473</td>
<td align="right">18.783743</td>
</tr>
<tr class="even">
<td align="right">0.75</td>
<td align="right">28.318452</td>
<td align="right">40.51633</td>
<td align="right">27.287575</td>
<td align="right">27.987029</td>
<td align="right">29.338806</td>
<td align="right">28.873589</td>
</tr>
<tr class="odd">
<td align="right">0.90</td>
<td align="right">49.552634</td>
<td align="right">49.81589</td>
<td align="right">40.976073</td>
<td align="right">44.167452</td>
<td align="right">47.110506</td>
<td align="right">43.926806</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span><span class="op">$</span><span class="fu">density_median</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/cvDistr-1.png" alt="Distribution of CV's" width="700"><p class="caption">
Distribution of CV’s
</p>
</div>
<p>In the next figure we show the dependency of the standard deviation
with respect to the mean intensitiy of the proteins.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stdm_raw</span> <span class="op">&lt;-</span> <span class="va">stats</span><span class="op">$</span><span class="fu">stdv_vs_mean</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">stdm_raw</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/stdvVSmean-1.png" alt="Scatter plot of standard deviation vs mean" width="700"><p class="caption">
Scatter plot of standard deviation vs mean
</p>
</div>
<div class="section level3">
<h3 id="normalize-protein-intensities">Normalize protein intensities<a class="anchor" aria-label="anchor" href="#normalize-protein-intensities"></a>
</h3>
<p>Next, we want to normalize the data by first <span class="math inline">\(\log_2\)</span> transforming it and then
z-scaling. The <span class="math inline">\(log_2\)</span> stabilizes the
variance, while the z-scaling removes systematic differences from the
samples.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lt</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_Transformer</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">transformed</span> <span class="op">&lt;-</span> <span class="va">lt</span><span class="op">$</span><span class="fu">log2</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">robscale</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">lfq</span></span>
<span><span class="va">transformed</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">is_response_transformed</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>Again we want to look into the distribution of the intensities in our
samples after normalization.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">transformed</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl</span><span class="op">$</span><span class="fu">intensity_distribution_density</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/plotDensities-1.png" alt="Normalized intensities." width="700"><p class="caption">
Normalized intensities.
</p>
</div>
<p>plots matrix scatter plot in the upper right matrix and some
statistics in the lower left matrix.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span><span class="op">$</span><span class="fu">pairs_smooth</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/plotScatterMatrix-1.png" alt="Scatterplot matrix" width="700"><p class="caption">
Scatterplot matrix
</p>
</div>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>plots protein heatmap:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">pl</span><span class="op">$</span><span class="fu">heatmap</span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">p</span> </span></code></pre></div>
<div class="figure" style="text-align: 5">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/plotheatmap-1.png" alt="Heatmap, Rows - proteins, Columns - samples" width="700"><p class="caption">
Heatmap, Rows - proteins, Columns - samples
</p>
</div>
<p>We can also look at the correlation among the samples or look at a
PCA plot.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">&lt;-</span> <span class="va">pl</span><span class="op">$</span><span class="fu">heatmap_cor</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span></span></code></pre></div>
<div class="figure" style="text-align: 5">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/plotHeatmapCor-1.png" alt="Heatmap based on sample correlations, Rows - samples, Columns - samples" width="700"><p class="caption">
Heatmap based on sample correlations, Rows - samples, Columns - samples
</p>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span><span class="op">$</span><span class="fu">pca</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: 5">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/doPCA-1.png" alt="Principal component analysis for all samples" width="700"><p class="caption">
Principal component analysis for all samples
</p>
</div>
<p>prints the standard deviations:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="va">transformed</span><span class="op">$</span><span class="fu">get_Stats</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">stats</span><span class="op">$</span><span class="fu">stats_quantiles</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">wide</span>, <span class="st">"Standard deviations"</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Standard deviations</caption>
<colgroup>
<col width="9%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="right">probs</th>
<th align="right">a</th>
<th align="right">All</th>
<th align="right">b</th>
<th align="right">c</th>
<th align="right">d</th>
<th align="right">e</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.10</td>
<td align="right">0.1155187</td>
<td align="right">0.1705211</td>
<td align="right">0.0818247</td>
<td align="right">0.0774830</td>
<td align="right">0.0796168</td>
<td align="right">0.1166550</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">0.1606369</td>
<td align="right">0.2036308</td>
<td align="right">0.1243041</td>
<td align="right">0.1226522</td>
<td align="right">0.1130250</td>
<td align="right">0.1569384</td>
</tr>
<tr class="odd">
<td align="right">0.50</td>
<td align="right">0.2482721</td>
<td align="right">0.3265151</td>
<td align="right">0.2072076</td>
<td align="right">0.2102231</td>
<td align="right">0.2026477</td>
<td align="right">0.2220905</td>
</tr>
<tr class="even">
<td align="right">0.75</td>
<td align="right">0.3887605</td>
<td align="right">0.5944839</td>
<td align="right">0.3643693</td>
<td align="right">0.3731324</td>
<td align="right">0.3897003</td>
<td align="right">0.3739025</td>
</tr>
<tr class="odd">
<td align="right">0.90</td>
<td align="right">0.6705950</td>
<td align="right">0.7757268</td>
<td align="right">0.6759042</td>
<td align="right">0.6264167</td>
<td align="right">0.6485692</td>
<td align="right">0.6970665</td>
</tr>
</tbody>
</table>
<p>plots density of the standard deviation</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span><span class="op">$</span><span class="fu">density_median</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/sddensity-1.png" alt="Density of the standard deviation" width="700"><p class="caption">
Density of the standard deviation
</p>
</div>
<p>Check for heteroskedasticity. After transformation, the standard
deviation should be independent of the mean intensity.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stdm_trans</span> <span class="op">&lt;-</span> <span class="va">stats</span><span class="op">$</span><span class="fu">stdv_vs_mean</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">stdm_trans</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/checkForHeteroskedasticity-1.png" alt="Scatter plot of sd vs mean of protein intensity" width="700"><p class="caption">
Scatter plot of sd vs mean of protein intensity
</p>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#gridExtra::grid.arrange(stdm_raw, stdm_trans, nrow=1)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimate-sample-size">Estimate sample size<a class="anchor" aria-label="anchor" href="#estimate-sample-size"></a>
</h3>
<p>For the sample size estimation we will now focus on only one
condition and the different bio-reps from the <em>a</em> dilution. In
this condition all samples have the same concentration and we want to
check variability within this group. Like this we can estimate how many
samples are necessary per group to quantify properly a two-fold change
(delta of 1) for 90% of all the proteins with a power of 0.8 and
significance level of 0.05.</p>
<p>First, we need to filter our data for <code>dilution.</code>
<em>a</em> only.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#startdata &lt;- startdata |&gt; dplyr::filter(sample  == "a")</span></span>
<span><span class="va">transformedA</span> <span class="op">&lt;-</span> <span class="va">transformed</span><span class="op">$</span><span class="fu">get_copy</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">transformedA</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">transformedA</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dilution.</span>  <span class="op">==</span> <span class="st">"a"</span><span class="op">)</span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="va">transformedA</span><span class="op">$</span><span class="fu">get_Stats</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span><span class="op">$</span><span class="fu">density</span><span class="op">(</span>ggstat <span class="op">=</span> <span class="st">"ecdf"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/unnamed-chunk-2-1.png" alt="Empirical cumulative density function of the standard deviation for all the proteins in the dataset." width="700"><p class="caption">
Empirical cumulative density function of the standard deviation for all
the proteins in the dataset.
</p>
</div>
<p>The table indicates that for this kind of data - if a two-fold change
for 90% of all the proteins should be accurately quantified with a power
of 0.8 (at 0.05 significance level) one would need to have 10 samples in
each group.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampleSize</span> <span class="op">&lt;-</span> <span class="va">stats</span><span class="op">$</span><span class="fu">power_t_test_quantiles</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dilution.</span> <span class="op">!=</span> <span class="st">"All"</span><span class="op">)</span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">sampleSize</span>, <span class="st">"Sample sizes. delta - Effect size, N - samplesize"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Sample sizes. delta - Effect size, N - samplesize</caption>
<thead><tr class="header">
<th align="left">dilution.</th>
<th align="right">probs</th>
<th align="right">quantiles</th>
<th align="right">sdtrimmed</th>
<th align="right">N_exact</th>
<th align="right">N</th>
<th align="right">delta</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">a</td>
<td align="right">0.10</td>
<td align="right">0.1155187</td>
<td align="right">0.1155187</td>
<td align="right">2.095048</td>
<td align="right">3</td>
<td align="right">0.59</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">0.25</td>
<td align="right">0.1606369</td>
<td align="right">0.1606369</td>
<td align="right">2.567965</td>
<td align="right">3</td>
<td align="right">0.59</td>
</tr>
<tr class="odd">
<td align="left">a</td>
<td align="right">0.50</td>
<td align="right">0.2482721</td>
<td align="right">0.2482721</td>
<td align="right">4.009378</td>
<td align="right">5</td>
<td align="right">0.59</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">0.75</td>
<td align="right">0.3887605</td>
<td align="right">0.3887605</td>
<td align="right">7.901731</td>
<td align="right">8</td>
<td align="right">0.59</td>
</tr>
<tr class="odd">
<td align="left">a</td>
<td align="right">0.90</td>
<td align="right">0.6705950</td>
<td align="right">0.6705950</td>
<td align="right">21.283776</td>
<td align="right">22</td>
<td align="right">0.59</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">0.10</td>
<td align="right">0.1155187</td>
<td align="right">0.1155187</td>
<td align="right">1.734376</td>
<td align="right">2</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">a</td>
<td align="right">0.25</td>
<td align="right">0.1606369</td>
<td align="right">0.1606369</td>
<td align="right">1.923936</td>
<td align="right">2</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">0.50</td>
<td align="right">0.2482721</td>
<td align="right">0.2482721</td>
<td align="right">2.402536</td>
<td align="right">3</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">a</td>
<td align="right">0.75</td>
<td align="right">0.3887605</td>
<td align="right">0.3887605</td>
<td align="right">3.634355</td>
<td align="right">4</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">0.90</td>
<td align="right">0.6705950</td>
<td align="right">0.6705950</td>
<td align="right">8.141436</td>
<td align="right">9</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">a</td>
<td align="right">0.10</td>
<td align="right">0.1155187</td>
<td align="right">0.1155187</td>
<td align="right">1.517830</td>
<td align="right">2</td>
<td align="right">2.00</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">0.25</td>
<td align="right">0.1606369</td>
<td align="right">0.1606369</td>
<td align="right">1.601261</td>
<td align="right">2</td>
<td align="right">2.00</td>
</tr>
<tr class="odd">
<td align="left">a</td>
<td align="right">0.50</td>
<td align="right">0.2482721</td>
<td align="right">0.2482721</td>
<td align="right">1.768559</td>
<td align="right">2</td>
<td align="right">2.00</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">0.75</td>
<td align="right">0.3887605</td>
<td align="right">0.3887605</td>
<td align="right">2.087670</td>
<td align="right">3</td>
<td align="right">2.00</td>
</tr>
<tr class="odd">
<td align="left">a</td>
<td align="right">0.90</td>
<td align="right">0.6705950</td>
<td align="right">0.6705950</td>
<td align="right">3.088201</td>
<td align="right">4</td>
<td align="right">2.00</td>
</tr>
</tbody>
</table>
<p>The table summarises visually how many samples are needed for
different expected differences (in log2-scale) and different portions of
all proteins.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampleSize</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span> , y <span class="op">=</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">delta</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/unnamed-chunk-3-1.png" alt="Estimated sample sizes for various FC levels and various quantiles of the standard deviation." width="700"><p class="caption">
Estimated sample sizes for various FC levels and various quantiles of
the standard deviation.
</p>
</div>
<p>It is also possible to get the statistics for each protein in each
group. The information includes group size, number of observations,
standard deviation, variance, mean.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span><span class="op">$</span><span class="fu">stats</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">##   protein_Id            dilution.     n not_na    sd    var  mean</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sp|A4D1E9|GTPBA_HUMAN a             4      4 0.117 0.013<span style="text-decoration: underline;">6</span>  25.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> sp|A6ZKI3|RTL8C_HUMAN a             4      4 0.150 0.022<span style="text-decoration: underline;">5</span>  25.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sp|C4AMC7|WASH3_HUMAN a             4      4 0.417 0.174   23.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> sp|O00203|AP3B1_HUMAN a             4      4 0.635 0.403   27.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> sp|O00461|GOLI4_HUMAN a             4      4 0.258 0.066<span style="text-decoration: underline;">8</span>  25.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> sp|O00505|IMA4_HUMAN  a             4      4 0.204 0.041<span style="text-decoration: underline;">5</span>  26.3</span></span></code></pre>
<p>You can also estimate the sample size needed to perform differential
expression analysis for each protein, given the <code>power</code>,
<code>delta</code>, and <code>sig.level</code>. The next figure shows
the distribution of needed sample sizes for all proteins with a power of
0.8 at signifiance level 0.05 for a two fold change (delta = 1).</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">stats</span><span class="op">$</span><span class="fu">power_t_test</span><span class="op">(</span>delta <span class="op">=</span> <span class="fl">1</span>,power <span class="op">=</span> <span class="fl">0.8</span>, sig.level <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dilution.</span> <span class="op">==</span> <span class="st">"a"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,<span class="va">protein_Id</span><span class="op">)</span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="op">]</span>, caption <span class="op">=</span> <span class="st">"Sample size for each protein"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Sample size for each protein</caption>
<colgroup>
<col width="32%">
<col width="10%">
<col width="3%">
<col width="7%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="6%">
<col width="10%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th align="left">protein_Id</th>
<th align="left">dilution.</th>
<th align="right">n</th>
<th align="right">not_na</th>
<th align="right">sd</th>
<th align="right">var</th>
<th align="right">mean</th>
<th align="right">delta</th>
<th align="right">N_exact</th>
<th align="right">N</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sp|Q6YHU6|THADA_HUMAN</td>
<td align="left">a</td>
<td align="right">4</td>
<td align="right">3</td>
<td align="right">2.629640</td>
<td align="right">6.915007</td>
<td align="right">25.87999</td>
<td align="right">1</td>
<td align="right">109.51881</td>
<td align="right">110</td>
</tr>
<tr class="even">
<td align="left">sp|Q6IN85|P4R3A_HUMAN</td>
<td align="left">a</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">1.969062</td>
<td align="right">3.877205</td>
<td align="right">23.30909</td>
<td align="right">1</td>
<td align="right">61.83861</td>
<td align="right">62</td>
</tr>
<tr class="odd">
<td align="left">sp|Q9NZM5|NOP53_HUMAN</td>
<td align="left">a</td>
<td align="right">4</td>
<td align="right">3</td>
<td align="right">1.562857</td>
<td align="right">2.442521</td>
<td align="right">23.61112</td>
<td align="right">1</td>
<td align="right">39.32594</td>
<td align="right">40</td>
</tr>
<tr class="even">
<td align="left">sp|O75362|ZN217_HUMAN</td>
<td align="left">a</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">1.453050</td>
<td align="right">2.111354</td>
<td align="right">23.84142</td>
<td align="right">1</td>
<td align="right">34.13100</td>
<td align="right">35</td>
</tr>
<tr class="odd">
<td align="left">sp|P76145|TAM_ECOLI</td>
<td align="left">a</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">1.323263</td>
<td align="right">1.751026</td>
<td align="right">21.95573</td>
<td align="right">1</td>
<td align="right">28.48018</td>
<td align="right">29</td>
</tr>
<tr class="even">
<td align="left">sp|Q9UJY5|GGA1_HUMAN</td>
<td align="left">a</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">1.297590</td>
<td align="right">1.683741</td>
<td align="right">21.72571</td>
<td align="right">1</td>
<td align="right">27.42524</td>
<td align="right">28</td>
</tr>
<tr class="odd">
<td align="left">sp|Q92747|ARC1A_HUMAN</td>
<td align="left">a</td>
<td align="right">4</td>
<td align="right">3</td>
<td align="right">1.268383</td>
<td align="right">1.608796</td>
<td align="right">23.76292</td>
<td align="right">1</td>
<td align="right">26.25031</td>
<td align="right">27</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">delta</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="QualityControlAndSampleSizeEstimation_files/figure-html/unnamed-chunk-4-1.png" alt="Distribution of the required sample sizes for two fold change thresholds for all the proteins." width="700"><p class="caption">
Distribution of the required sample sizes for two fold change thresholds
for all the proteins.
</p>
</div>
<p>The <code>prolfqua</code> package is described in <span class="citation">(Wolski et al. 2022)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.2.1 (2022-06-23)</span></span>
<span><span class="co">## Platform: aarch64-apple-darwin20 (64-bit)</span></span>
<span><span class="co">## Running under: macOS Ventura 13.2.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRblas.0.dylib</span></span>
<span><span class="co">## LAPACK: /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRlapack.dylib</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] ggrepel_0.9.3      Rcpp_1.0.10        lattice_0.20-45    tidyr_1.3.0       </span></span>
<span><span class="co">##  [5] rprojroot_2.0.3    conflicted_1.2.0   digest_0.6.31      utf8_1.2.3        </span></span>
<span><span class="co">##  [9] R6_2.5.1           cellranger_1.1.0   evaluate_0.20      httr_1.4.5        </span></span>
<span><span class="co">## [13] ggplot2_3.4.1      highr_0.10         pillar_1.8.1       rlang_1.0.6       </span></span>
<span><span class="co">## [17] lazyeval_0.2.2     readxl_1.4.2       prolfqua_1.1.1     data.table_1.14.8 </span></span>
<span><span class="co">## [21] jquerylib_0.1.4    Matrix_1.5-1       rmarkdown_2.20     pkgdown_2.0.6     </span></span>
<span><span class="co">## [25] textshaping_0.3.6  desc_1.4.2         labeling_0.4.2     splines_4.2.1     </span></span>
<span><span class="co">## [29] stringr_1.5.0      htmlwidgets_1.6.1  pheatmap_1.0.12    munsell_0.5.0     </span></span>
<span><span class="co">## [33] compiler_4.2.1     xfun_0.37          pkgconfig_2.0.3    systemfonts_1.0.4 </span></span>
<span><span class="co">## [37] mgcv_1.8-41        htmltools_0.5.4    tidyselect_1.2.0   tibble_3.1.8      </span></span>
<span><span class="co">## [41] gridExtra_2.3      fansi_1.0.4        viridisLite_0.4.1  dplyr_1.1.0       </span></span>
<span><span class="co">## [45] withr_2.5.0        MASS_7.3-58.1      grid_4.2.1         nlme_3.1-160      </span></span>
<span><span class="co">## [49] jsonlite_1.8.4     gtable_0.3.1       lifecycle_1.0.3    magrittr_2.0.3    </span></span>
<span><span class="co">## [53] scales_1.2.1       KernSmooth_2.23-20 cli_3.6.0          stringi_1.7.12    </span></span>
<span><span class="co">## [57] cachem_1.0.7       farver_2.1.1       fs_1.6.1           bslib_0.4.2       </span></span>
<span><span class="co">## [61] ragg_1.2.4         generics_0.1.3     vctrs_0.5.2        RColorBrewer_1.1-3</span></span>
<span><span class="co">## [65] tools_4.2.1        forcats_1.0.0      glue_1.6.2         purrr_1.0.1       </span></span>
<span><span class="co">## [69] fastmap_1.1.1      yaml_2.3.7         colorspace_2.1-0   memoise_2.0.1     </span></span>
<span><span class="co">## [73] plotly_4.10.1      knitr_1.42         sass_0.4.5</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Wolski2022.06.07.494524" class="csl-entry">
Wolski, Witold E., Paolo Nanni, Jonas Grossmann, Maria d’Errico, Ralph
Schlapbach, and Christian Panse. 2022. <span>“Prolfqua: A Comprehensive
<span class="nocase">R-package</span> for Proteomics Differential
Expression Analysis.”</span> <em>bioRxiv</em>. <a href="https://doi.org/10.1101/2022.06.07.494524" class="external-link">https://doi.org/10.1101/2022.06.07.494524</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Witold Wolski.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
