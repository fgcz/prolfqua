<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modelling dataset with two Factors • prolfqua</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modelling dataset with two Factors">
<meta property="og:description" content="prolfqua">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prolfqua</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Comparing2Groups.html">Comparing Two Groups with prolfqua</a>
    </li>
    <li>
      <a href="../articles/CreatingConfigurations.html">Creating prolfqua Configurations</a>
    </li>
    <li>
      <a href="../articles/Modelling2Factors.html">Modelling dataset with two Factors</a>
    </li>
    <li>
      <a href="../articles/QCandSampleSize.html">Quality Control &amp; Sample Size Estimation</a>
    </li>
    <li>
      <a href="../articles/QualityControlAndSampleSizeEstimation.html">QC and Sample Size Estimation</a>
    </li>
    <li>
      <a href="../articles/SimulateData.html">Simulate Peptide level Data</a>
    </li>
    <li>
      <a href="../articles/Supplement_TidyAnalysis_HL_Skyline.html">Supplement - Data preprocessing of SRM Heavy Light data</a>
    </li>
    <li>
      <a href="../articles/Supplement_TidyAnalysis_Skyline_PRM.html">Supplement - Data preprocessing for PRM</a>
    </li>
    <li>
      <a href="../articles/Supplement_TidyCorrelationAnalysis.html">Supplement - Filter precursors or fragments based on correlation</a>
    </li>
    <li>
      <a href="../articles/Supplement_srm_summary.html">Supplement - Summarize SRM Peptide Level Measurements</a>
    </li>
    <li>
      <a href="../articles/Supplement_srm_summary_HL.html">Supplement - Summarize heavy light Peptide Level Measurements</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wolski/prolfqua/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Modelling dataset with two Factors</h1>
                        <h4 data-toc-skip class="author">Witold E.
Wolski</h4>
            
            <h4 data-toc-skip class="date">2024-01-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wolski/prolfqua/blob/HEAD/vignettes/Modelling2Factors.Rmd" class="external-link"><code>vignettes/Modelling2Factors.Rmd</code></a></small>
      <div class="hidden name"><code>Modelling2Factors.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>This vignette demonstrates how to integrate more than one factor into
the linear models. Here, we show how to model the data with two factors
plus the interaction thereof. The underlying dataset is generated in a
course that is held on a yearly base. The context is that yeast is, in
one condition, grown on glucose, and in the other condition, yeast is
grown on glycerol and ethanol. Here we are looking into the results of
two different batches, where different people performed the wet-lab
work, and even different LC-MS instruments were involved. It is,
therefore, essential to model the batch variable for these two
<em>similar</em> datasets. We are also modeling the interaction between
the two explanatory variables <em>batch</em> and _condition_for
demonstration purposes. In this case, having a significant interaction
term would mean the protein is expressed more in the Glucose condition
in one batch. In contrast, the same protein is more abundant in the
Ethanol condition in the other batch.</p>
<p>An in depth introduction to modelling and testing interactions can be
found <a href="http://genomicsclass.github.io/book/pages/interactions_and_contrasts.html" class="external-link">here</a>.</p>
</div>
<div class="section level2">
<h2 id="model-fitting">Model Fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h2>
<p>For more details how the dataset <code>data_Yeast2Factor</code> was
created we refer you to the prolfquabenchmark vignettes. Interesting
here is the definition of the model. If interaction shall be included in
the model a <em>asterix</em> should be used while if no interaction
should be taken into account a <em>plus</em> should be used in the model
definition. Also we can directly specify what comparisons we are
interested in by specifying the respective contrasts.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">conflicted</span><span class="fu">::</span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html" class="external-link">conflict_prefer</a></span><span class="op">(</span><span class="st">"filter"</span>, <span class="st">"dplyr"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_Yeast2Factor</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/prolfqua_data.html">prolfqua_data</a></span><span class="op">(</span><span class="st">"data_Yeast2Factor"</span><span class="op">)</span></span>
<span><span class="va">data_Yeast2Factor</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/LFQData.html">LFQData</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">data_Yeast2Factor</span><span class="op">$</span><span class="va">data</span>, <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/old2new.html">old2new</a></span><span class="op">(</span><span class="va">data_Yeast2Factor</span><span class="op">$</span><span class="va">config</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pMerged</span> <span class="op">&lt;-</span> <span class="va">data_Yeast2Factor</span></span>
<span><span class="va">pMerged</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Run_ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pMerged</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Run_ID</span><span class="op">)</span></span>
<span><span class="va">pMerged</span><span class="op">$</span><span class="fu">factors</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 18 × 5</span></span></span>
<span><span class="co">##    raw.file                        sampleName       condition_ batch_ Run_ID</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 20170314_06_ge3                 Ethanol~p2370~06 Ethanol    p2370       6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 20170314_08_ge1                 Ethanol~p2370~08 Ethanol    p2370       8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 20170314_09_ge2_rep             Ethanol~p2370~09 Ethanol    p2370       9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 20170314_12_ge4                 Ethanol~p2370~12 Ethanol    p2370      12</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 20180313_03_ge4_ls_180314100836 Ethanol~p2691~03 Ethanol    p2691       3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 20180313_06_ge1_ap              Ethanol~p2691~06 Ethanol    p2691       6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 20180313_09_ge3_cw              Ethanol~p2691~09 Ethanol    p2691       9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 20180313_10_ge2_zf              Ethanol~p2691~10 Ethanol    p2691      10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 20180313_12_ge1_jtk             Ethanol~p2691~12 Ethanol    p2691      12</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 20170314_02_g3_rep              Glucose~p2370~02 Glucose    p2370       2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> 20170314_04_g4                  Glucose~p2370~04 Glucose    p2370       4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> 20170314_07_g1_a                Glucose~p2370~07 Glucose    p2370       7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> 20170314_10_g1_b                Glucose~p2370~10 Glucose    p2370      10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span> 20170314_11_g2                  Glucose~p2370~11 Glucose    p2370      11</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">15</span> 20180313_04_g3_sw_180314112243  Glucose~p2691~04 Glucose    p2691       4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">16</span> 20180313_05_g2_mb               Glucose~p2691~05 Glucose    p2691       5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">17</span> 20180313_08_g4_cm               Glucose~p2691~08 Glucose    p2691       8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">18</span> 20180313_11_g1_ap               Glucose~p2691~11 Glucose    p2691      11</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula_Batches</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/strategy.html">strategy_lm</a></span><span class="op">(</span><span class="st">"transformedIntensity ~ condition_ * batch_ "</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specify model definition</span></span>
<span><span class="va">Contrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Glucose - Ethanol"</span> <span class="op">=</span> <span class="st">"condition_Glucose - condition_Ethanol"</span>,</span>
<span>               <span class="st">"p2370 - p2691"</span> <span class="op">=</span> <span class="st">"batch_p2370 - batch_p2691"</span>,</span>
<span>               <span class="st">"Glucose_vs_Ethanol_gv_p2370"</span> <span class="op">=</span> <span class="st">"`condition_Glucose:batch_p2370` - `condition_Ethanol:batch_p2370`"</span>,</span>
<span>               <span class="st">"Glucose_vs_Ethanol_gv_p2691"</span> <span class="op">=</span> <span class="st">"`condition_Glucose:batch_p2691` - `condition_Ethanol:batch_p2691`"</span>,</span>
<span>               <span class="st">"Interaction"</span> <span class="op">=</span> <span class="st">"`Glucose_vs_Ethanol_gv_p2370` - `Glucose_vs_Ethanol_gv_p2691`"</span><span class="op">)</span></span></code></pre></div>
<p>We are then building our model as we specified it before for each
protein.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/build_model.html">build_model</a></span><span class="op">(</span><span class="va">pMerged</span><span class="op">$</span><span class="va">data</span>, <span class="va">formula_Batches</span>,</span>
<span>  subject_Id <span class="op">=</span> <span class="va">pMerged</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="fu">hierarchy_keys</span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<p>Now, we can visualize the effect of our factors that are specified in
the model. This indicates in an elegant way what factors are the most
important ones.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="fu">anova_histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<div class="figure">
<img src="Modelling2Factors_files/figure-html/anovaPvaluePlots-1.png" alt="Distributions of all p-values from the ANOVA analysis." width="700"><p class="caption">
Distributions of all p-values from the ANOVA analysis.
</p>
</div>
<div class="section level3">
<h3 id="anova">ANOVA<a class="anchor" aria-label="anchor" href="#anova"></a>
</h3>
<p>To examine proteins with a significant interaction between the two
factors treatment and batch filtering for the factor
<code>condition_:batch_</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ANOVA</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">get_anova</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ANOVA</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">factor</span> <span class="op">==</span> <span class="st">"condition_:batch_"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">FDR</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 10</span></span></span>
<span><span class="co">##   protein_Id       isSingular nrcoef factor    Df Sum.Sq Mean.Sq F.value p.value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> sp|P36095|VPS24… FALSE           4 condi…     1  11.0    11.0     79.0 9.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> sp|Q12159|YRA1_… FALSE           4 condi…     1   4.86    4.86    33.9 4.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sp|P09624|DLDH_… FALSE           4 condi…     1   1.40    1.40    27.5 1.24<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> sp|Q08225|DPP3_… FALSE           4 condi…     1   3.59    3.59    24.2 2.83<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> sp|P32783|MCES_… FALSE           4 condi…     1   7.90    7.90    37.4 4.85<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: FDR &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">protIntSig</span> <span class="op">&lt;-</span> <span class="va">ANOVA</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">factor</span> <span class="op">==</span> <span class="st">"condition_:batch_"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">FDR</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">protInt</span> <span class="op">&lt;-</span>  <span class="va">pMerged</span><span class="op">$</span><span class="fu">get_copy</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">protInt</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">protInt</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="va">protInt</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">protein_Id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">protIntSig</span><span class="op">$</span><span class="va">protein_Id</span>,<span class="op">]</span></span></code></pre></div>
<p>These proteins can easily be visualized using the
<code>boxplot</code> function from the <code>plotter</code> objects in
prolfqua</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">protInt</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">boxplots</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">boxplot</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Modelling2Factors_files/figure-html/unnamed-chunk-1-1.png" alt="Proteins with FDR &lt; 0.05 for the interaction in the factors condition and batch in an ANOVA." width="700"><p class="caption">
Proteins with FDR &lt; 0.05 for the interaction in the factors condition
and batch in an ANOVA.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="compute-and-analyse-with-the-specified-contrasts">Compute and analyse with the specified contrasts<a class="anchor" aria-label="anchor" href="#compute-and-analyse-with-the-specified-contrasts"></a>
</h2>
<p>Next, we want to calculate the statistical results for our group
comparisons that have been specified in our contrast definition. Here we
are using the moderated statistics which implements the concept of
pooled variance for all proteins.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contr</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/ContrastsModerated.html">ContrastsModerated</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/Contrasts.html">Contrasts</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">mod</span>, <span class="va">Contrasts</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">contrdf</span> <span class="op">&lt;-</span> <span class="va">contr</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>These results can be visualized with e.g a <code>volcano</code> or a
<code>MA</code> plot.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotter</span> <span class="op">&lt;-</span> <span class="va">contr</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">plotter</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FDR</span></span></code></pre></div>
<div class="figure">
<img src="Modelling2Factors_files/figure-html/visualiseResults-1.png" alt="Volcano and MA plot for result visualisation" width="700"><p class="caption">
Volcano and MA plot for result visualisation
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotter</span><span class="op">$</span><span class="fu">ma_plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Modelling2Factors_files/figure-html/visualiseResults-2.png" alt="Volcano and MA plot for result visualisation" width="700"><p class="caption">
Volcano and MA plot for result visualisation
</p>
</div>
<div class="section level3">
<h3 id="analyse-contrasts-with-missing-data-imputation">Analyse contrasts with missing data imputation<a class="anchor" aria-label="anchor" href="#analyse-contrasts-with-missing-data-imputation"></a>
</h3>
<p>Still using the approach above, we can only estimate group averages
in case there is at least one measurement for each protein in each
group/condition. In the case of missing data for one condition, we can
use the <code>ContrastsMissing</code> function where the 10th percentile
expression of all proteins is used for the estimate of the missing
condition.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pMerged</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="fu">factor_keys_depth</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "condition_" "batch_"</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrSimple</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/ContrastsMissing.html">ContrastsMissing</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">pMerged</span>, <span class="va">Contrasts</span><span class="op">)</span></span>
<span><span class="va">contrdfSimple</span> <span class="op">&lt;-</span> <span class="va">contrSimple</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">contrSimple</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl</span><span class="op">$</span><span class="fu">histogram_diff</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Modelling2Factors_files/figure-html/prepareForGroupAverageImputation-1.png" alt="Volcano and MA plot for result visualisation for the group average model" width="700"><p class="caption">
Volcano and MA plot for result visualisation for the group average model
</p>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FDR</span></span></code></pre></div>
<div class="figure">
<img src="Modelling2Factors_files/figure-html/prepareForGroupAverageImputation-2.png" alt="Volcano and MA plot for result visualisation for the group average model" width="700"><p class="caption">
Volcano and MA plot for result visualisation for the group average model
</p>
</div>
</div>
<div class="section level3">
<h3 id="merge-nonimputed-and-imputed-data-">Merge nonimputed and imputed data.<a class="anchor" aria-label="anchor" href="#merge-nonimputed-and-imputed-data-"></a>
</h3>
<p>For the moderated model, we can only get results if we have enough
valid data points. With the group average model we can get group
estimates for all proteins. Therefore, we are merging the statistics for
both approaches while we are preferring the values of the moderated
model. Also these results can again be visualized in a
<code>volcano</code> plot.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">contr</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1695   13</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">contrSimple</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2500   13</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mergedContrasts</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/merge_contrasts_results.html">merge_contrasts_results</a></span><span class="op">(</span>prefer <span class="op">=</span> <span class="va">contr</span>, add <span class="op">=</span> <span class="va">contrSimple</span><span class="op">)</span><span class="op">$</span><span class="va">merged</span></span>
<span><span class="va">cM</span> <span class="op">&lt;-</span> <span class="va">mergedContrasts</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">cM</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">plot</span><span class="op">$</span><span class="va">FDR</span></span></code></pre></div>
<div class="figure">
<img src="Modelling2Factors_files/figure-html/doGroupAverageImputation-1.png" alt="Volcano plot of moderated (black) and impuation (light green) model" width="700"><p class="caption">
Volcano plot of moderated (black) and impuation (light green) model
</p>
</div>
<div class="section level4">
<h4 id="look-at-proteins-with-significant-interaction-term-">Look at Proteins with significant interaction term.<a class="anchor" aria-label="anchor" href="#look-at-proteins-with-significant-interaction-term-"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sigInteraction</span> <span class="op">&lt;-</span> <span class="va">mergedContrasts</span><span class="op">$</span><span class="va">contrast_result</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">contrast</span> <span class="op">==</span> <span class="st">"Interaction"</span> <span class="op">&amp;</span> <span class="va">FDR</span> <span class="op">&lt;</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">protInt</span> <span class="op">&lt;-</span>  <span class="va">pMerged</span><span class="op">$</span><span class="fu">get_copy</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">protInt</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">protInt</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="va">protInt</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">protein_Id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sigInteraction</span><span class="op">$</span><span class="va">protein_Id</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">protInt</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">raster</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Modelling2Factors_files/figure-html/visualiseSomeProteins-1.png" alt="Heatmap for proteins that show a FDR &lt; 0.2 for the contrast interaction." width="700"><p class="caption">
Heatmap for proteins that show a FDR &lt; 0.2 for the contrast
interaction.
</p>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hm</span> <span class="op">&lt;-</span> <span class="va">protInt</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">heatmap</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hm</span></span></code></pre></div>
<div class="figure">
<img src="Modelling2Factors_files/figure-html/interactionHeatmap-1.png" alt="Proteinheatmap for proteins with significant Interactions" width="700"><p class="caption">
Proteinheatmap for proteins with significant Interactions
</p>
</div>
<p>The <code>prolfqua</code> package is described in <span class="citation">(Wolski et al. 2022)</span>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="testing-interaction-computation">Testing interaction computation<a class="anchor" aria-label="anchor" href="#testing-interaction-computation"></a>
</h2>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/genomicsclass/dagdata/master/inst/extdata/spider_wolff_gorb_2013.csv"</span></span>
<span><span class="va">filename</span> <span class="op">&lt;-</span> <span class="st">"spider_wolff_gorb_2013.csv"</span></span>
<span><span class="fu">downloader</span><span class="fu">::</span><span class="fu">download</span><span class="op">(</span><span class="va">url</span>, <span class="va">filename</span><span class="op">)</span></span>
<span><span class="va">spider</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">filename</span>, skip <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">XA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">friction</span> <span class="op">~</span> <span class="va">type</span> <span class="op">*</span> <span class="va">leg</span>, data <span class="op">=</span> <span class="va">spider</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">XA</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spider</span><span class="op">)</span></span>
<span><span class="va">spider</span> <span class="op">&lt;-</span> <span class="va">spider</span> <span class="op">|&gt;</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite</a></span><span class="op">(</span><span class="va">legtype</span> , <span class="va">leg</span>, <span class="va">type</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">XF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">friction</span> <span class="op">~</span> <span class="va">legtype</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">spider</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">glht</span><span class="op">(</span><span class="va">XF</span>, linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span>i1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span> ,<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">glht</span><span class="op">(</span><span class="va">XF</span>, linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span>i1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">glht</span><span class="op">(</span><span class="va">XF</span>, linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span>i1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>,  <span class="fl">0</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.2 (2023-10-31)</span></span>
<span><span class="co">## Platform: aarch64-apple-darwin20 (64-bit)</span></span>
<span><span class="co">## Running under: macOS Sonoma 14.2.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">## LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: Europe/Zurich</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] beeswarm_0.4.0     gtable_0.3.4       xfun_0.40          bslib_0.5.1       </span></span>
<span><span class="co">##  [5] ggplot2_3.4.4      htmlwidgets_1.6.2  rstatix_0.7.2      ggrepel_0.9.3     </span></span>
<span><span class="co">##  [9] vctrs_0.6.4        tools_4.3.2        generics_0.1.3     tibble_3.2.1      </span></span>
<span><span class="co">## [13] fansi_1.0.5        pkgconfig_2.0.3    pheatmap_1.0.12    data.table_1.14.8 </span></span>
<span><span class="co">## [17] RColorBrewer_1.1-3 desc_1.4.2         lifecycle_1.0.3    prolfqua_1.1.5    </span></span>
<span><span class="co">## [21] farver_2.1.1       compiler_4.3.2     stringr_1.5.0      textshaping_0.3.6 </span></span>
<span><span class="co">## [25] progress_1.2.2     munsell_0.5.0      carData_3.0-5      vipor_0.4.5       </span></span>
<span><span class="co">## [29] htmltools_0.5.6    sass_0.4.7         yaml_2.3.7         lazyeval_0.2.2    </span></span>
<span><span class="co">## [33] plotly_4.10.1      car_3.1-2          ggpubr_0.6.0       pillar_1.9.0      </span></span>
<span><span class="co">## [37] pkgdown_2.0.7      crayon_1.5.2       jquerylib_0.1.4    tidyr_1.3.0       </span></span>
<span><span class="co">## [41] MASS_7.3-60        cachem_1.0.8       abind_1.4-5        tidyselect_1.2.0  </span></span>
<span><span class="co">## [45] conflicted_1.2.0   digest_0.6.33      stringi_1.7.12     dplyr_1.1.3       </span></span>
<span><span class="co">## [49] purrr_1.0.2        labeling_0.4.3     forcats_1.0.0      cowplot_1.1.1     </span></span>
<span><span class="co">## [53] rprojroot_2.0.3    fastmap_1.1.1      grid_4.3.2         colorspace_2.1-0  </span></span>
<span><span class="co">## [57] cli_3.6.1          magrittr_2.0.3     utf8_1.2.3         broom_1.0.4       </span></span>
<span><span class="co">## [61] withr_2.5.1        backports_1.4.1    prettyunits_1.1.1  scales_1.2.1      </span></span>
<span><span class="co">## [65] ggbeeswarm_0.7.2   rmarkdown_2.25     httr_1.4.7         gridExtra_2.3     </span></span>
<span><span class="co">## [69] ggsignif_0.6.4     ragg_1.2.5         hms_1.1.3          memoise_2.0.1     </span></span>
<span><span class="co">## [73] evaluate_0.21      knitr_1.44         viridisLite_0.4.2  rlang_1.1.1       </span></span>
<span><span class="co">## [77] Rcpp_1.0.11        glue_1.6.2         jsonlite_1.8.7     R6_2.5.1          </span></span>
<span><span class="co">## [81] systemfonts_1.0.4  fs_1.6.3</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Wolski2022.06.07.494524" class="csl-entry">
Wolski, Witold E., Paolo Nanni, Jonas Grossmann, Maria d’Errico, Ralph
Schlapbach, and Christian Panse. 2022. <span>“Prolfqua: A Comprehensive
<span class="nocase">R-package</span> for Proteomics Differential
Expression Analysis.”</span> <em>bioRxiv</em>. <a href="https://doi.org/10.1101/2022.06.07.494524" class="external-link">https://doi.org/10.1101/2022.06.07.494524</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Witold Wolski.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
